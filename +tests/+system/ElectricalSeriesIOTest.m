classdef ElectricalSeriesIOTest < tests.system.PyNWBIOTest
    methods(Test)
        function testOutToPyNWB(testCase)
            testCase.assumeFail(['Current schema in MatNWB does not include a ElectrodeTable class used by Python tests. ', ...
                'When it does, addContainer in this test will need to be updated to match the Python test']);
        end
        
        function testInFromPyNWB(testCase)
            testCase.assumeFail(['Current schema in MatNWB does not include a ElectrodeTable class used by Python tests. ', ...
                'When it does, addContainer in this test will need to be updated to match the Python test']);
        end
    end
    
    methods
        function addContainer(testCase, file) %#ok<INUSL>
            devnm = 'dev1';
            egnm = {'tetrode1';'tetrode2'};
            esnm = 'test_eS';
            devBase = '/general/devices/';
            ephysBase = '/general/extracellular_ephys/';
            devlink = types.untyped.SoftLink([devBase devnm]);
            eglink = types.untyped.ObjectView([ephysBase egnm{1}]);
            eglink2 = types.untyped.ObjectView([ephysBase egnm{2}]);
            etReg = types.untyped.ObjectView([ephysBase 'electrodes']);
            dev = types.core.Device();
            file.general_devices.set(devnm, dev);
            eg = [...
                types.core.ElectrodeGroup( ...
                'description', 'tetrode description', ...
                'location', 'tetrode location', ...
                'device', devlink);...
                types.core.ElectrodeGroup(...
                'description', 'testrode desc', ...
                'location', 'tetrode2 location', ...
                'device', devlink)];
            etColNames = {'x', 'y', 'z', 'imp', 'location', 'filtering',...
                'description','group', 'group_name'};
            etTblVal = {rand(2,1), rand(2,1), rand(2,1), rand(2,1), {'';''},{'';''},...
                {'test','test2'}, [eglink;eglink2], egnm};
            
            ettable = types.core.DynamicTable(...
                'colnames', etColNames,...
                'id', types.core.ElementIdentifiers('data', int64(1:2)),...
                'tablecolumn', types.untyped.Set(containers.Map(...
                etColNames, etTblVal)),...
                'description', 'electrodes');
            
            file.general_extracellular_ephys.set('electrodes',ettable);
            file.general_extracellular_ephys.set(egnm, eg);
            es = types.core.ElectricalSeries( ...
                'data', int32([0:9;10:19]) .', ...
                'timestamps', (0:9) .', ...
                'electrodes', ...
                types.core.DynamicTableRegion(...
                'data', 1,...
                'table', etReg,...
                'description', 'test etr'));
            file.acquisition.set(esnm, es);
        end
        
        function c = getContainer(testCase, file) %#ok<INUSL>
            c = file.acquisition.get('test_eS');
        end
    end
end

